<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>&iexcl;Feliz Cumplea&ntilde;os, Aby Alvarez! &mdash; 23</title>
  <meta name="description" content="Landing m&oacute;vil con parallax, motion graphics y animaciones sutiles para celebrar los 23 de Aby Alvarez." />
  <meta name="theme-color" content="#0F172A" />
  <style>
    :root{
      --bg-dark:#0F172A; /* slate-900 */
      --bg-light:#F8FAFC; /* slate-50 */
      --gold:#F59E0B; /* amber-500 */
      --magenta:#E879F9; /* fuchsia-400 */
      --sky:#38BDF8; /* sky-400 */
      --ink:#0B1220;
      --paper:#ffffff;
      --glass:rgba(255,255,255,0.08);
      --glass-b:rgba(255,255,255,0.16);
      --radius-lg:18px;
      --radius-md:14px;
      --shadow-soft:0 10px 30px rgba(0,0,0,.2);
      --shadow-tiny:0 4px 10px rgba(0,0,0,.12);
      --ease: cubic-bezier(.22,.61,.36,1);
    }

    @property --card-bob-y{
      syntax:'<length>';
      inherits:false;
      initial-value:0px;
    }
    @property --glint-angle{
      syntax:'<angle>';
      inherits:false;
      initial-value:0deg;
    }
    /* Theme (light/dark) */
    html { color-scheme: dark;}
    body[data-theme="light"]{ --ink:#1E293B; --paper:#F8FAFC; color:#1E293B; background:var(--paper);} 
    body[data-theme="dark"]{ --ink:#E5E7EB; --paper:var(--bg-dark); color:#E5E7EB; background:radial-gradient(1000px 600px at 50% -10%, rgba(248,250,252,.08), transparent 60%), var(--paper);} 

    /* Reset */
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;position:relative;overflow-x:hidden}
    h1,h2,h3,p{margin:0 0 .75rem 0}
    img{max-width:100%;display:block;height:auto}
    a{color:inherit}
    button{font:inherit}

    /* Utilities */
    .wrap{width:min(1040px, 92vw); margin-inline:auto}
    .section{position:relative; padding:72px 0}
    .sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    .muted{opacity:.8}
    .center{text-align:center}

    /* Header / Theme Toggle */
    header.site{position:fixed; inset:0 0 auto 0; height:56px; display:flex; align-items:center; z-index:40; mix-blend-mode:normal; backdrop-filter:saturate(120%) blur(10px); -webkit-backdrop-filter:saturate(120%) blur(10px); border-bottom:1px solid rgba(255,255,255,.08)}
    header.site .wrap{display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; align-items:center; gap:.6rem; letter-spacing:.06em; font-weight:700}
    .brand .dot{width:8px; height:8px; border-radius:999px; background:linear-gradient(145deg,var(--gold),var(--magenta))}
    .toggle{display:inline-flex; align-items:center; gap:.5rem; border:1px solid rgba(255,255,255,.2); background:var(--glass); color:inherit; padding:.45rem .7rem; border-radius:999px; cursor:pointer; box-shadow:var(--shadow-tiny)}
    .toggle:focus-visible{outline:2px solid var(--sky); outline-offset:2px}

    /* HERO */
    .hero{min-height:100svh; display:grid; place-items:center; position:relative; overflow:hidden; padding-top:56px}
    .hero .parallax{position:absolute; inset:0; transform-style:preserve-3d; perspective:900px}
    .layer{position:absolute; inset:0; will-change:transform}
    .stars{background:radial-gradient(2px 2px at 20% 40%, rgba(255,255,255,.8), transparent 50%),
                         radial-gradient(1.5px 1.5px at 70% 30%, rgba(255,255,255,.7), transparent 50%),
                         radial-gradient(1.2px 1.2px at 40% 70%, rgba(255,255,255,.65), transparent 50%),
                         radial-gradient(1.8px 1.8px at 80% 60%, rgba(255,255,255,.75), transparent 50%),
                         radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,.6), transparent 50%);
            opacity:.45}
    .glow{background:radial-gradient(60vw 40vh at 50% 20%, rgba(232,121,249,.18), transparent 55%),
                          radial-gradient(50vw 36vh at 50% 80%, rgba(56,189,248,.15), transparent 60%)}

    main .wrap{text-align:center}
    .story .wrap p{max-width:640px; margin-inline:auto; text-align:center}
    .card p{max-width:520px; margin-inline:auto; text-align:center}

    /* Floating balloons */
    .balloons{pointer-events:none; overflow:hidden; opacity:.85}
    .layer.balloons{position:fixed; inset:0; z-index:-1; mix-blend-mode:screen; pointer-events:none;}
    body[data-theme="light"] .layer.balloons{mix-blend-mode:multiply; opacity:.55;}
    .balloon{position:absolute; top:0; left:var(--left,50%); width:var(--size, clamp(58px, 9vw, 94px)); aspect-ratio:3/4; border-radius:50% 50% 45% 45% / 55% 55% 45% 45%;
             background:radial-gradient(120% 140% at 30% 20%, rgba(255,255,255,.65), rgba(255,255,255,0) 48%),
                        linear-gradient(160deg, rgba(255,255,255,.3), rgba(255,255,255,.05) 35%, rgba(15,23,42,.18) 100%),
                        linear-gradient(150deg, var(--tone-a,#f1f5f9), var(--tone-b,#cbd5f5));
             box-shadow:0 18px 32px rgba(15,23,42,.32); opacity:0; filter:saturate(108%); mix-blend-mode:screen; transition:left 6s ease-in-out, opacity 1.2s ease-in-out;
             animation:balloon-rise var(--duration,16s) linear infinite; animation-delay:var(--delay,-9s); animation-duration:var(--duration,16s);}
    .balloon:after{content:""; position:absolute; inset:auto 0 -24px 0; margin:auto; width:2px; height:28px; background:linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,0));}

    @keyframes balloon-rise{
      0%{transform:translate3d(-50%,110vh,var(--depth,-12px)) scale(var(--scale,1)); opacity:0;}
      10%{opacity:.7;}
      45%{transform:translate3d(calc(-50% + var(--drift,0px)),-6vh,var(--depth,-12px)) scale(var(--scale-hi,1.1)); opacity:.82;}
      100%{transform:translate3d(calc(-50% + var(--drift-end,0px)),-130vh,var(--depth,-12px)) scale(var(--scale,1)); opacity:0;}
    }


    /* Confetti (subtle) */
    .confetti{position:fixed; inset:-12% 0 0 0; pointer-events:none; z-index:6; overflow:hidden; mix-blend-mode:screen;}
    body[data-theme="light"] .confetti{mix-blend-mode:multiply; opacity:.9;}
    body[data-theme="light"] .confetti .piece{opacity:.85; filter:saturate(1.3); mix-blend-mode:normal;}
    .piece{position:absolute; width:6px; height:10px; border-radius:2px; opacity:.7; transform:translateY(-20vh) rotate(0deg); animation: fall linear infinite}
    @keyframes fall{ 100%{ transform: translateY(120vh) rotate(360deg) } }

    .hero-content{position:relative; z-index:2; text-align:center; padding:1rem}
    .title{font-size: clamp(34px, 7vw, 72px); line-height:1.05; letter-spacing:.02em; font-weight:800;
           background:linear-gradient(92deg, var(--gold), var(--magenta), var(--sky));
           background-clip:text; -webkit-background-clip:text; -webkit-text-fill-color:transparent;
           filter: drop-shadow(0 6px 18px rgba(0,0,0,.28));
           animation: titleGlow 8s linear infinite}
    @keyframes titleGlow{ 0%{ text-shadow: 0 0 0 rgba(255,255,255,0) } 50%{ text-shadow: 0 0 24px rgba(255,255,255,.15) } 100%{ text-shadow: 0 0 0 rgba(255,255,255,0) } }

    .subtitle{font-size:clamp(16px, 4.2vw, 22px); opacity:.92; letter-spacing:.04em; animation: fadeInUp .9s var(--ease) both .2s}
    @keyframes fadeInUp{ from{ opacity:0; transform:translateY(10px) } to{ opacity:1; transform:translateY(0) } }

    .scroll-hint{position:absolute; left:50%; bottom:22px; transform:translateX(-50%); display:grid; place-items:center; gap:6px; color:rgba(255,255,255,.9)}
    body[data-theme="light"] .scroll-hint{color:rgba(71,85,105,.85);}
    .chev{width:20px; height:28px; border:2px solid currentColor; border-radius:12px; position:relative}
    .chev:after{content:""; position:absolute; left:50%; top:6px; width:4px; height:6px; transform:translateX(-50%); border-radius:3px; background:currentColor; animation: scrollDot 1.6s ease-in-out infinite}
    @keyframes scrollDot{ 0%,100%{ transform: translate(-50%,0) } 50%{ transform: translate(-50%,10px) } }

    /* MESSAGE SECTION */
    .story{position:relative; isolation:isolate; overflow:hidden;
           background:radial-gradient(70% 80% at 50% 8%, rgba(232,121,249,.16), transparent 68%),
                      radial-gradient(120% 120% at 50% 110%, rgba(56,189,248,.12), transparent 78%),
                      linear-gradient(180deg, transparent, rgba(255,255,255,.03)),
                      radial-gradient(1000px 300px at 50% -120px, rgba(255,255,255,.06), transparent),
                      var(--paper);}
    .story-flowers{position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:.82;}
    .story .wrap{display:grid; gap:1.25rem; position:relative; z-index:2;}
    .story p{font-size:1.05rem; opacity:0; transform: translateY(8px); transition: transform .7s var(--ease), opacity .7s var(--ease)}
    .story p.is-visible{opacity:1; transform: translateY(0)}

    .story .decor{position:absolute; inset:auto auto -120px -40px; width:240px; height:240px; background: radial-gradient(closest-side, rgba(245,158,11,.35), transparent 70%); filter:blur(20px); mix-blend-mode:screen; pointer-events:none; z-index:1;}

    /* HIGHLIGHTS */
    .highlights .grid{display:grid; grid-template-columns:1fr; gap:24px; padding:0 4px;}
    @media(min-width:720px){ .highlights .grid{grid-template-columns:repeat(3,minmax(0,1fr)); gap:28px;} }
    .card{position:relative; isolation:isolate; overflow:visible; border-radius:var(--radius-lg); background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.05));
          border:1px solid rgba(148,163,209,.26); padding:22px; backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
          box-shadow:0 18px 36px rgba(15,23,42,.32); transform-style:preserve-3d; opacity:0; cursor:pointer; text-align:center;
          --card-offset:14px; --card-scale:.98; --card-bob-y:0px; --card-delay:0s;
          transform:translateY(calc(var(--card-offset) + var(--card-bob-y))) scale(var(--card-scale));
          animation:card-bob 6.8s ease-in-out infinite; animation-delay:var(--card-delay);
          transition:transform .7s var(--ease), opacity .7s var(--ease), box-shadow .5s var(--ease), border-color .5s var(--ease), background .5s var(--ease);}
    .card:nth-of-type(2){ --card-delay:-2.1s;}
    .card:nth-of-type(3){ --card-delay:-3.4s;}

    .card::before{content:""; position:absolute; inset:-4px; border-radius:inherit;
                  background:conic-gradient(from var(--glint-angle), rgba(255,255,255,0) 0deg, rgba(255,255,255,.65) 10deg, rgba(248,172,120,.45) 16deg, rgba(232,121,249,.45) 22deg, rgba(56,189,248,.38) 28deg, rgba(255,255,255,0) 40deg),
                             conic-gradient(from 60deg, rgba(56,189,248,.22), rgba(129,140,248,.2), rgba(232,121,249,.24), rgba(248,172,120,.18), rgba(56,189,248,.22));
                  filter:blur(18px); opacity:.46; pointer-events:none; mix-blend-mode:screen; animation:card-glint 18s linear infinite; transform-origin:center;
                  mask: radial-gradient(closest-side, transparent calc(100% - 18px), rgba(0,0,0,.85) calc(100% - 7px));
                  -webkit-mask: radial-gradient(closest-side, transparent calc(100% - 18px), rgba(0,0,0,.85) calc(100% - 7px));}
    .card::after{content:""; position:absolute; inset:0; border-radius:inherit; border:1px solid rgba(255,255,255,.32); background:linear-gradient(145deg, rgba(255,255,255,.18), rgba(148,163,209,.08));
                 mix-blend-mode:screen; opacity:.72; pointer-events:none; transition:opacity .45s var(--ease), border-color .45s var(--ease)}
    .card.is-visible{opacity:1; --card-offset:0px; --card-scale:1}
    .card:hover{--card-offset:-6px; --card-scale:1.03; --card-bob-y:0px; animation-play-state:paused; box-shadow:0 26px 48px rgba(15,23,42,.5); border-color:rgba(148,163,209,.38)}
    .card:hover::before{opacity:.58; filter:blur(22px)}
    .card:hover::after{opacity:.95}
    .card.is-pressed{--card-offset:-4px; --card-scale:1.04; --card-bob-y:0px; animation-play-state:paused; background:linear-gradient(185deg, rgba(255,255,255,.26), rgba(255,255,255,.08)); box-shadow:0 32px 60px rgba(15,23,42,.58); border-color:rgba(148,163,209,.46)}
    .card.is-pressed::before{opacity:.78; filter:blur(16px)}
    .card.is-pressed::after{opacity:1}
    .card .icon{width:40px; height:40px; margin:0 auto .75rem auto; display:block}
    .card h3{font-size:1.05rem; letter-spacing:.04em; margin-bottom:.35rem}
    .spec{position:absolute; inset:auto 10px 10px auto; width:120px; height:120px; background:conic-gradient(from 120deg, rgba(255,255,255,.14), transparent 60%);
          filter:blur(16px); opacity:.5; pointer-events:none}

    @keyframes card-bob{
      0%,100%{ --card-bob-y:6px; }
      50%{ --card-bob-y:-7px; }
    }

    @keyframes card-glint{from{ --glint-angle:0deg; } to{ --glint-angle:360deg; }}


    /* COUNTDOWN */
    .countdown{display:grid; place-items:center; gap:18px; text-align:center}
    .countdown-title{font-size:clamp(22px, 4vw, 32px); letter-spacing:.08em; text-transform:uppercase; font-weight:700; color:var(--ink);}
    .countdown-card{position:relative; width:min(620px, 92vw); margin-inline:auto; padding:28px clamp(18px, 6vw, 42px); border-radius:28px; background:linear-gradient(145deg, rgba(15,23,42,.55), rgba(30,41,59,.32)); border:1px solid rgba(148,163,209,.24); box-shadow:0 22px 45px rgba(15,23,42,.32); backdrop-filter:blur(18px) saturate(140%); -webkit-backdrop-filter:blur(18px) saturate(140%); overflow:hidden;}
    .countdown-card::before{content:""; position:absolute; inset:-40% -20% auto; height:160%; background:radial-gradient(ellipse at top, rgba(248,172,120,.22), transparent 65%); opacity:.45; transform:rotate(6deg); pointer-events:none;}
    .countdown-card::after{content:""; position:absolute; inset:2px; border-radius:inherit; border:1px solid rgba(255,255,255,.12); mix-blend-mode:overlay; pointer-events:none;}
    .countdown-grid{position:relative; z-index:1; display:grid; grid-template-columns:repeat(auto-fit, minmax(130px, 1fr)); gap:18px;}
    .time-cell{position:relative; padding:18px 12px 16px; border-radius:22px; background:linear-gradient(160deg, rgba(148,163,209,.24), rgba(15,23,42,.45)); border:1px solid rgba(148,163,209,.35); box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 12px 24px rgba(15,23,42,.32); display:grid; gap:6px; justify-items:center;}
    .time-cell::before{content:""; position:absolute; inset:6px; border-radius:18px; background:linear-gradient(120deg, rgba(248,172,120,.25), rgba(232,121,249,.18)); opacity:.4; filter:blur(18px); pointer-events:none;}
    .time-cell .value{position:relative; color:var(--ink); font-size:clamp(32px, 6vw, 46px); font-weight:700; letter-spacing:.12em; font-variant-numeric:tabular-nums; text-shadow:0 8px 18px rgba(15,23,42,.4);}
    .time-cell .label{position:relative; font-size:.75rem; text-transform:uppercase; letter-spacing:.24em; font-weight:600; color:rgba(226,232,240,.85);}
    body[data-theme="light"] .countdown-card{background:linear-gradient(145deg, rgba(241,245,249,.88), rgba(255,255,255,.74)); border-color:rgba(30,41,59,.14); box-shadow:0 22px 45px rgba(15,23,42,.18);}
    body[data-theme="light"] .countdown-card::before{background:radial-gradient(ellipse at top, rgba(248,172,120,.32), transparent 70%);}
    body[data-theme="light"] .time-cell{background:linear-gradient(160deg, rgba(255,255,255,.95), rgba(226,232,240,.78)); border-color:rgba(148,163,209,.32); box-shadow:inset 0 1px 0 rgba(255,255,255,.8), 0 14px 26px rgba(148,163,209,.28);}
    body[data-theme="light"] .time-cell::before{background:linear-gradient(160deg, rgba(248,172,120,.32), rgba(232,121,249,.22)); opacity:.5;}
    body[data-theme="light"] .time-cell .label{color:rgba(71,85,105,.82);}

    /* GALLERY */
    .gallery{position:relative;}
    .gallery .wrap{display:grid; gap:18px; text-align:center;}
    .gallery-note{max-width:520px; margin:0 auto; color:rgba(226,232,240,.78);}
    .carousel-wrap{position:relative; width:min(640px, 88vw); margin-inline:auto; perspective:1200px;}
    .carousel-wrap::after{content:""; position:absolute; inset:auto 10% -36px 10%; height:48px; border-radius:50%; background:radial-gradient(circle, rgba(232,121,249,.48), rgba(56,189,248,.18) 48%, transparent 70%); filter:blur(14px); opacity:.65; pointer-events:none;}
    .carousel-stage{position:relative; padding-top:60%; overflow:hidden;}
    .carousel{position:absolute; inset:0; transform-style:preserve-3d; animation:carousel-spin 22s linear infinite; width:100%; height:100%;}
    .carousel.is-paused{animation-play-state:paused;}
    .carousel:hover{animation-play-state:paused;}
    .carousel-item{--radius: clamp(240px, 36vw, 320px); --tilt: -6deg; position:absolute; top:50%; left:50%; width:clamp(190px,32vw,240px); aspect-ratio:3/4; border-radius:26px; overflow:hidden; transform-style:preserve-3d; transform:rotateY(calc(var(--index) * 120deg)) translateZ(var(--radius)) rotateX(var(--tilt)) translateY(-50%); box-shadow:0 24px 36px rgba(15,23,42,.35), inset 0 1px 0 rgba(255,255,255,.2); opacity:0; transition:opacity .8s var(--ease), transform .8s var(--ease);}
    .carousel-item.is-visible{opacity:1;}
    .carousel.is-ready .carousel-item{opacity:1;}
    .carousel-item::before{content:""; position:absolute; inset:-18%; border-radius:32px; background:conic-gradient(from 120deg, rgba(56,189,248,.25), rgba(232,121,249,.25), rgba(248,172,120,.25), rgba(56,189,248,.25)); mix-blend-mode:screen; opacity:.55; filter:blur(18px); pointer-events:none;}
    .carousel-item::after{content:""; position:absolute; inset:0; border-radius:inherit; border:1px solid rgba(255,255,255,.22); mix-blend-mode:overlay; pointer-events:none;}
    .carousel-item img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:saturate(1.12) contrast(1.02); transform:scale(1.02);}
    body[data-theme="light"] .gallery-note{color:rgba(71,85,105,.75);}
    body[data-theme="light"] .carousel-wrap::after{background:radial-gradient(circle, rgba(232,121,249,.38), rgba(56,189,248,.18) 52%, transparent 72%); opacity:.72;}
    body[data-theme="light"] .carousel-item{box-shadow:0 20px 30px rgba(148,163,209,.32), inset 0 1px 0 rgba(255,255,255,.7); background:linear-gradient(160deg, rgba(255,255,255,.75), rgba(226,232,240,.68));}
    body[data-theme="light"] .carousel-item::after{border-color:rgba(148,163,209,.24);}
    @keyframes carousel-spin{to{transform:rotateY(-360deg);}}
    @media (prefers-reduced-motion: reduce){
      .carousel{animation-duration:120s;}
      .carousel-item{transform:rotateY(calc(var(--index) * 120deg)) translateZ(calc(var(--radius)*.8)) rotateX(-4deg) translateY(-50%);}
    }

    /* CLOSING / SURPRISE */
    .closing{display:grid; place-items:center; text-align:center; padding-bottom:120px}
    .closing .big{font-size: clamp(26px, 6vw, 46px); font-weight:900; letter-spacing:.03em; line-height:1.15; background: linear-gradient(100deg, var(--gold), var(--magenta), var(--sky));
                  background-clip:text; -webkit-background-clip:text; -webkit-text-fill-color:transparent; position:relative}
    .sweep{position:absolute; inset:0; background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.9), rgba(255,255,255,0)); mix-blend-mode:screen; transform: translateX(-120%); filter: blur(6px)}
    .play{margin-top:14px; border:1px solid rgba(255,255,255,.3); background:var(--glass); padding:.7rem 1rem; border-radius:999px; cursor:pointer; box-shadow:var(--shadow-tiny); color:inherit;}
    body[data-theme="light"] .play{background:rgba(15,23,42,.08); border-color:rgba(15,23,42,.16); color:#0f172a;}
    body[data-theme="dark"] .play{color:var(--ink);}
    .play:focus-visible{outline:2px solid var(--sky); outline-offset:3px}


    #fx{position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:75; opacity:0; transition:opacity .7s var(--ease);}
    #fx.is-active{opacity:1;}
    .celebration-overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:clamp(30px, 8vw, 80px) 0; z-index:80; pointer-events:none; opacity:0; transform:translateY(12px); transition:opacity .8s var(--ease), transform .8s var(--ease); background:radial-gradient(120% 140% at 50% 110%, rgba(14,116,144,.28), transparent 70%), radial-gradient(90% 90% at 50% 8%, rgba(232,121,249,.24), transparent 68%);}
    .celebration-overlay::after{content:""; position:absolute; inset:0; background:radial-gradient(620px 520px at 50% 50%, rgba(255,255,255,.12), transparent 72%); mix-blend-mode:screen; opacity:.45; pointer-events:none;}
    .celebration-overlay.is-visible{opacity:1; transform:translateY(0); pointer-events:auto;}
    .celebration-layer{position:absolute; inset:0; overflow:hidden; pointer-events:none;}
    .balloon-field{z-index:2;}
    .confetti-field{z-index:3;}
    .celebration-balloon{position:absolute; bottom:-20vh; left:50%; width:var(--size,90px); height:calc(var(--size,90px)*1.28); border-radius:48% 52% 44% 46% / 64% 64% 40% 40%; background:radial-gradient(120% 140% at 30% 20%, rgba(255,255,255,.8), rgba(255,255,255,0) 55%), linear-gradient(160deg, rgba(255,255,255,.28), rgba(255,255,255,0) 45%, rgba(15,23,42,.24) 100%), radial-gradient(140% 110% at 50% 10%, hsla(var(--hue,42),88%,78%,.95), hsla(var(--hue,42),82%,56%,1)); box-shadow:0 18px 36px rgba(15,23,42,.35); transform:translate3d(calc(-50% + var(--drift-start,0px)), 120vh, 0) scale(var(--scale,1)); opacity:0; animation:celebrationBalloon var(--duration,12s) cubic-bezier(.18,.6,.22,1) forwards; animation-delay:var(--delay,0s);}
    .celebration-balloon::after{content:""; position:absolute; bottom:-32px; left:50%; width:2px; height:38px; transform:translateX(-50%); background:linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,0)); box-shadow:0 0 10px rgba(255,255,255,.35);}
    .celebration-balloon::before{content:""; position:absolute; top:16%; right:18%; width:20%; height:24%; border-radius:50%; background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.75), rgba(255,255,255,0)); filter:blur(2px);}
    @keyframes celebrationBalloon{
      0%{transform:translate3d(calc(-50% + var(--drift-start,0px)), 120vh, 0) scale(var(--scale,1)); opacity:0;}
      12%{opacity:.94;}
      55%{transform:translate3d(calc(-50% + var(--drift-mid,0px)), -6vh, 0) scale(var(--scale-hi,1.12));}
      100%{transform:translate3d(calc(-50% + var(--drift-end,0px)), -160vh, 0) scale(var(--scale,1)); opacity:0;}
    }
    .celebration-confetti{position:absolute; bottom:-12vh; left:var(--left,50%); width:var(--width,8px); height:var(--height,16px); border-radius:3px; background:linear-gradient(140deg, var(--color-a,#F59E0B), var(--color-b,#F97316)); transform-origin:center; transform:translate3d(var(--sway-start,0px), 110vh, 0) rotateZ(0deg) rotateX(0deg); opacity:0; animation:celebrationConfetti var(--duration,6.2s) ease-in-out forwards; animation-delay:var(--delay,0s); box-shadow:0 6px 12px rgba(15,23,42,.18);}
    .celebration-confetti::after{content:""; position:absolute; inset:-35% -40% 30% -40%; border-radius:50%; background:radial-gradient(circle, rgba(255,255,255,.35), rgba(255,255,255,0)); opacity:.65; mix-blend-mode:screen;}
    @keyframes celebrationConfetti{
      0%{transform:translate3d(var(--sway-start,0px), 110vh, 0) rotateZ(0deg) rotateX(0deg); opacity:0;}
      12%{opacity:1;}
      45%{transform:translate3d(var(--sway-mid,0px), -16vh, 0) rotateZ(var(--spin-mid,160deg)) rotateX(var(--tilt-mid,32deg));}
      100%{transform:translate3d(var(--sway-end,0px), 126vh, 0) rotateZ(var(--spin-end,320deg)) rotateX(var(--tilt-end,-12deg)); opacity:0;}
    }
    .cake-stage{position:relative; z-index:4; display:flex; flex-direction:column; align-items:center; gap:14px; text-align:center; opacity:0; transform:translate3d(0,24px,0) scale(.9); transition:opacity .8s var(--ease), transform .8s var(--ease); pointer-events:none;}
    .celebration-overlay.show-cake .cake-stage{opacity:1; transform:translate3d(0,0,0) scale(1); pointer-events:auto;}
    .cake-stage__prompt{font-size:clamp(20px, 4.6vw, 28px); letter-spacing:.05em; font-weight:700; text-transform:uppercase; color:#fff; text-shadow:0 8px 20px rgba(15,23,42,.4);}
    body[data-theme="light"] .cake-stage__prompt{color:#0f172a; text-shadow:0 6px 16px rgba(148,163,209,.5);}
    .cake-stage__button{border:none; border-radius:999px; padding:.55rem 1.8rem; font-weight:600; letter-spacing:.05em; cursor:pointer; background:linear-gradient(120deg, rgba(56,189,248,.82), rgba(232,121,249,.78)); color:#0f172a; box-shadow:0 14px 26px rgba(15,23,42,.34); transition:transform .3s var(--ease), box-shadow .3s var(--ease); backdrop-filter:blur(6px);}
    .cake-stage__button:hover{transform:translateY(-2px); box-shadow:0 18px 34px rgba(15,23,42,.38);}
    .cake-stage__button:focus-visible{outline:2px solid #38BDF8; outline-offset:3px;}
    .cake-stage__button:disabled{opacity:.6; cursor:not-allowed; transform:none; box-shadow:none;}
    .cake-stage__button.is-complete{background:linear-gradient(120deg, rgba(248,250,252,.78), rgba(191,219,254,.85)); color:#0b1220; box-shadow:0 12px 24px rgba(15,23,42,.32); transform:none;}
    body[data-theme="light"] .cake-stage__button{background:linear-gradient(120deg, rgba(191,219,254,.92), rgba(254,252,232,.86)); box-shadow:0 12px 24px rgba(148,163,209,.4);}
    body[data-theme="light"] .cake-stage__button.is-complete{background:linear-gradient(120deg, rgba(248,250,252,.94), rgba(226,232,240,.92)); color:#1f2937; box-shadow:0 10px 20px rgba(148,163,209,.28);}
    .cake-stage.is-hiding{opacity:0; transform:translate3d(0,36px,0) scale(.88); pointer-events:none;}
    .celebration-overlay.is-dismissing{opacity:0; transform:translateY(24px); pointer-events:none;}
    .cake{position:relative; width:clamp(220px, 46vw, 340px); height:clamp(220px, 44vw, 320px); display:flex; align-items:flex-end; justify-content:center; perspective:1600px; transform-style:preserve-3d; filter:drop-shadow(0 24px 40px rgba(15,23,42,.45));}
    .cake__shadow{position:absolute; bottom:-6%; width:140%; height:20%; border-radius:50%; background:radial-gradient(circle at 50% 20%, rgba(15,23,42,.45), rgba(15,23,42,0)); filter:blur(18px); z-index:0; pointer-events:none;}
    .cake__stand{position:absolute; bottom:-2%; width:150%; height:24%; border-radius:50%; background:linear-gradient(180deg, rgba(248,250,252,.92), rgba(191,219,254,.6)); box-shadow:inset 0 6px 14px rgba(255,255,255,.8), inset 0 -12px 22px rgba(15,23,42,.22); transform:translateZ(-20px); pointer-events:none;}
    .cake__tier{position:absolute; left:50%; transform:translateX(-50%); border-radius:50% / 22%; overflow:visible; box-shadow:inset 0 8px 15px rgba(255,255,255,.32), inset 0 -16px 22px rgba(15,23,42,.28); pointer-events:none;}
    .cake__tier::before{content:""; position:absolute; inset:10% 12% 26% 12%; border-radius:50% / 24%; background:repeating-linear-gradient(135deg, rgba(255,255,255,.24) 0 14px, rgba(255,255,255,0) 14px 26px); mix-blend-mode:soft-light; opacity:.45;}
    .cake__tier--bottom{bottom:12%; width:88%; height:38%; background:linear-gradient(160deg, rgba(249,115,22,.92), rgba(251,191,36,.85), rgba(243,232,255,.75));}
    .cake__tier--middle{bottom:34%; width:64%; height:30%; background:linear-gradient(150deg, rgba(236,72,153,.88), rgba(217,70,239,.82), rgba(96,165,250,.78));}
    .cake__tier--top{bottom:56%; width:42%; height:24%; background:linear-gradient(150deg, rgba(125,211,252,.9), rgba(196,181,253,.85), rgba(248,250,252,.9));}
    .cake__band{position:absolute; inset:auto 14% 24% 14%; height:24%; border-radius:999px; background:linear-gradient(90deg, rgba(255,255,255,.6), rgba(251,191,36,.7), rgba(255,255,255,.5)); mix-blend-mode:screen; opacity:.85;}
    .cake__band--middle{inset:auto 18% 24% 18%; background:linear-gradient(90deg, rgba(255,255,255,.6), rgba(244,114,182,.74), rgba(255,255,255,.6));}
    .cake__band--top{inset:auto 22% 28% 22%; background:linear-gradient(90deg, rgba(255,255,255,.7), rgba(125,211,252,.65), rgba(255,255,255,.7));}
    .cake__frosting{position:absolute; left:0; right:0; height:42%; border-radius:50% 50% 45% 45% / 75% 75% 35% 35%; background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,0)); filter:drop-shadow(0 10px 18px rgba(255,255,255,.4));}
    .cake__frosting--bottom{top:-12%; box-shadow:0 16px 18px rgba(255,255,255,.28);}
    .cake__frosting--middle{top:-14%; background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(247,171,248,.55));}
    .cake__frosting--top{top:-16%; background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.5));}
    .cake__flower{position:absolute; width:clamp(18px, 4vw, 32px); height:clamp(18px, 4vw, 32px); border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff, rgba(232,121,249,.9)); box-shadow:0 8px 16px rgba(232,121,249,.45); pointer-events:none;}
    .cake__flower::after{content:""; position:absolute; inset:28% 28% 28% 28%; border-radius:50%; background:radial-gradient(circle, rgba(56,189,248,.6), rgba(232,121,249,0)); mix-blend-mode:screen;}
    .cake__flower--1{bottom:18%; left:18%; transform:rotate(-12deg);}
    .cake__flower--2{bottom:16%; right:20%; transform:scale(.9) rotate(18deg); background:radial-gradient(circle at 30% 30%, #fff, rgba(244,114,182,.9));}
    .cake__flower--3{bottom:32%; left:24%; transform:scale(.85) rotate(-6deg); background:radial-gradient(circle at 30% 30%, #fff, rgba(129,140,248,.9));}
    .cake__flower--4{bottom:46%; right:24%; transform:scale(.8) rotate(10deg); background:radial-gradient(circle at 30% 30%, #fff, rgba(134,239,172,.92));}
    .cake__candles{position:absolute; top:20%; left:50%; transform:translateX(-50%); display:flex; gap:clamp(18px, 4vw, 28px); align-items:flex-end; pointer-events:none;}
    .candle{position:relative; width:clamp(12px, 2vw, 18px); height:clamp(60px, 10vw, 80px); display:flex; align-items:flex-start; justify-content:center;}
    .candle__body{position:absolute; bottom:0; left:0; right:0; height:76%; border-radius:8px 8px 10px 10px; background:linear-gradient(180deg, rgba(255,255,255,.85), var(--candle-color,#f472b6)); box-shadow:inset 0 6px 12px rgba(255,255,255,.5), inset 0 -8px 10px rgba(15,23,42,.25);}
    .candle__body::after{content:""; position:absolute; inset:20% 26% 30% 26%; border-radius:8px; background:radial-gradient(circle at 50% 20%, rgba(255,255,255,.8), rgba(255,255,255,0)); opacity:.6;}
    .candle:nth-child(1) .candle__body{--candle-color:rgba(244,114,182,.82);}
    .candle:nth-child(2) .candle__body{--candle-color:rgba(125,211,252,.82);}
    .candle:nth-child(3) .candle__body{--candle-color:rgba(252,211,77,.84);}
    .candle:nth-child(4) .candle__body{--candle-color:rgba(196,181,253,.82);}
    .candle__wick{position:absolute; top:-8px; width:3px; height:16px; border-radius:999px; background:linear-gradient(180deg, rgba(15,23,42,.95), rgba(148,163,209,.6));}
    .candle__flame{position:absolute; top:-32px; width:clamp(12px, 2.4vw, 18px); height:clamp(26px, 4vw, 34px); border-radius:45% 45% 55% 55%; background:radial-gradient(circle at 40% 20%, rgba(255,255,255,.95), rgba(255,230,128,.8) 48%, rgba(249,115,22,.65) 70%, rgba(220,38,38,.2)); box-shadow:0 0 16px rgba(251,191,36,.75); transform-origin:50% 80%; animation:flameDance .6s ease-in-out infinite alternate; opacity:.96;}
    .candle:nth-child(2) .candle__flame{animation-duration:.54s;}
    .candle:nth-child(3) .candle__flame{animation-duration:.62s;}
    .candle__smoke{position:absolute; top:-26px; width:clamp(16px, 3vw, 22px); height:clamp(32px, 5vw, 40px); border-radius:50%; background:radial-gradient(circle at 50% 30%, rgba(241,245,249,.55), rgba(148,163,209,0)); filter:blur(4px); opacity:0; transform:translateY(8px) scale(.6); pointer-events:none;}
    .candle__smoke--b{transform:translate(4px, 12px) scale(.5);}
    @keyframes flameDance{
      0%{transform:scale(1) translateY(0) rotate(-4deg); filter:drop-shadow(0 6px 12px rgba(251,191,36,.9));}
      50%{transform:scale(.9) translateY(2px) rotate(3deg);}
      100%{transform:scale(1.05) translateY(-1px) rotate(-2deg);}
    }
    .cake-stage.candles-out .candle__flame{animation:flameOut .7s ease-in forwards;}
    @keyframes flameOut{
      0%{opacity:1; transform:scale(1) translateY(0);}
      40%{opacity:.8; transform:scale(.8) translateY(-4px);}
      100%{opacity:0; transform:scale(.25) translateY(-24px);}
    }
    .cake-stage.candles-out .candle__smoke{animation:smokeRise 1.6s ease-out forwards;}
    .cake-stage.candles-out .candle__smoke--b{animation-delay:.18s;}
    @keyframes smokeRise{
      0%{opacity:0; transform:translateY(6px) scale(.5);}
      20%{opacity:.6;}
      60%{opacity:.35;}
      100%{opacity:0; transform:translateY(-32px) scale(1.1);}
    }

    /* FOOTER */
    footer{padding:36px 0 48px; text-align:center; opacity:.8}
    .to-top{position:fixed; right:14px; bottom:14px; z-index:50; border-radius:999px; width:46px; height:46px; display:grid; place-items:center; border:1px solid rgba(255,255,255,.3); background:var(--glass); box-shadow:var(--shadow-tiny); opacity:0; transform:translateY(10px); pointer-events:none; transition:opacity .3s, transform .3s}
    .to-top.show{opacity:1; transform:translateY(0); pointer-events:auto}

    .audio-toggle{position:fixed; left:14px; bottom:14px; z-index:60; width:48px; height:48px; display:grid; place-items:center; border-radius:999px; border:1px solid rgba(255,255,255,.32); background:var(--glass); color:inherit; box-shadow:0 10px 20px rgba(15,23,42,.26); backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px); cursor:pointer; transition:transform .3s var(--ease), box-shadow .3s var(--ease), border-color .3s var(--ease), opacity .3s var(--ease);}
    .audio-toggle::before{content:""; position:absolute; inset:-6px; border-radius:inherit; background:conic-gradient(from 0deg, rgba(232,121,249,.45), rgba(248,172,120,.36), rgba(56,189,248,.38), rgba(232,121,249,.45)); filter:blur(12px); opacity:.6; z-index:-1; animation:audioGlow 5.2s linear infinite;}
    .audio-toggle .icon{font-size:1.15rem; line-height:1;}
    .audio-toggle:hover{transform:translateY(-2px); box-shadow:0 18px 32px rgba(15,23,42,.34);}
    .audio-toggle:focus-visible{outline:2px solid var(--sky); outline-offset:4px;}
    .audio-toggle.is-paused{border-color:rgba(255,255,255,.24); opacity:.88;}
    .audio-toggle.is-paused::before{animation-duration:6.8s; opacity:.45;}
    body[data-theme="light"] .audio-toggle{background:rgba(248,250,252,.92); color:#0f172a; border-color:rgba(148,163,209,.4); box-shadow:0 14px 26px rgba(148,163,209,.26);}
    body[data-theme="light"] .audio-toggle::before{background:conic-gradient(from 0deg, rgba(232,121,249,.5), rgba(248,172,120,.36), rgba(56,189,248,.42), rgba(232,121,249,.5));}
    @keyframes audioGlow{to{transform:rotate(360deg);}}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration: .001ms !important; scroll-behavior:auto !important}
      .card:hover{--card-offset:0; --card-scale:1; --card-bob-y:0}
      .card{animation:none !important}
    }
  </style>
</head>
<body data-theme="dark">
  <audio id="bg-audio" src="asset/audio.mp3" preload="auto" autoplay playsinline></audio>
  <a href="#main" class="sr-only">Saltar al contenido</a>
  <header class="site" role="banner" aria-label="Barra superior">
    <div class="wrap">
      <div class="brand" aria-label="Marca">
        <span class="dot" aria-hidden="true"></span>
        <span>Celebrando a Aby Alvarez</span>
      </div>
      <button id="theme" class="toggle" aria-pressed="false" aria-label="Cambiar tema claro/oscuro">
        <span aria-hidden="true">&#127763;</span><span class="muted">Tema</span>
      </button>
    </div>
  </header>
  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <main id="main" tabindex="-1">
    <!-- HERO -->
    <section class="hero section" aria-labelledby="t-hero">
      <div class="parallax" aria-hidden="true">
        <div class="layer stars" style="transform: translateZ(-60px);"></div>
        <div class="layer glow" style="transform: translateZ(-30px);"></div>
        <div class="layer balloons" aria-hidden="true"></div>
      </div>
      <div class="hero-content wrap">
        <h1 id="t-hero" class="title" aria-live="polite">&iexcl;Feliz Cumplea&ntilde;os, Aby Alvarez!</h1>
        <p class="subtitle">Un abrazo con mucho cari&ntilde;o</p>
      </div>
      <div class="scroll-hint" aria-hidden="true">
        <div class="chev"></div>
        <small class="muted">Desliza</small>
      </div>
    </section>

    <!-- STORY / MESSAGE -->
    <section class="story section" aria-label="Mensaje de cari&ntilde;o">
      <canvas id="story-flowers" class="story-flowers" aria-hidden="true"></canvas>
      <span class="decor" aria-hidden="true"></span>
      <div class="wrap">
        <p class="reveal">Que este nuevo a&ntilde;o est&eacute; lleno de alegr&iacute;a genuina, metas cumplidas y momentos que le hagan sonre&iacute;r con el alma.</p>
        <p class="reveal">Que sea siempre luz en la vida de quienes la rodean. Hoy celebramos su historia, su presente y todo lo bello que viene.</p>
      </div>
    </section>

    <!-- HIGHLIGHTS -->
    <section class="highlights section" aria-labelledby="t-high">
      <div class="wrap">
        <h2 id="t-high" class="center" style="letter-spacing:.06em">Peque&ntilde;os Detalles de Grandeza</h2>
        <div class="grid" style="margin-top:16px">
          <article class="card reveal" role="article" aria-label="Tu sonrisa que ilumina">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 100 20 10 10 0 000-20Zm0 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3Zm0 14a7 7 0 01-6.32-4h2.19A5 5 0 0012 17a5 5 0 004.13-2H18.3A7 7 0 0112 19Z"/></svg>
            <h3>La sonrisa que ilumina</h3>
            <p class="muted">Esa chispa que alegra d&iacute;as nublados y convierte momentos simples en memorables.</p>
            <i class="spec" aria-hidden="true"></i>
          </article>
          <article class="card reveal" role="article" aria-label="Tus sue&ntilde;os que crecen">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 3l7 4v6c0 5-7 8-7 8s-7-3-7-8V7l7-4Zm0 3.2L7 8v4.8c0 3.52 3.83 5.9 5 6.53 1.17-.63 5-3.01 5-6.53V8l-5-1.8Z"/></svg>
            <h3>Los sue&ntilde;os que crecen</h3>
            <p class="muted">Paso a paso, constancia y Dios en el coraz&oacute;n: lo mejor a&uacute;n est&aacute; por venir.</p>
            <i class="spec" aria-hidden="true"></i>
          </article>
          <article class="card reveal" role="article" aria-label="Tu energ&iacute;a que inspira">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M11 21h-1l1-7H7l6-11h1l-1 7h4l-6 11Z"/></svg>
            <h3>La energ&iacute;a que inspira</h3>
            <p class="muted">Su presencia motiva, empuja y enciende nuevas ideas en todos.</p>
            <i class="spec" aria-hidden="true"></i>
          </article>
        </div>
      </div>
    </section>

    <!-- COUNTDOWN / TODAY NOTE -->
    <section class="countdown section" aria-live="polite">
      <div class="wrap center">
        <h2 class="countdown-title">Mi Pr&oacute;ximo Cumplea&ntilde;os</h2>
        <p id="today-note" class="muted"></p>
        <div class="countdown-card">
          <div class="countdown-grid" id="digits" aria-label="Cuenta atr&aacute;s para el pr&oacute;ximo cumplea&ntilde;os">
            <div class="time-cell">
              <span id="d-day" class="value">000</span>
              <span class="label">D&iacute;as</span>
            </div>
            <div class="time-cell">
              <span id="d-h" class="value">00</span>
              <span class="label">Horas</span>
            </div>
            <div class="time-cell">
              <span id="d-m" class="value">00</span>
              <span class="label">Minutos</span>
            </div>
            <div class="time-cell">
              <span id="d-s" class="value">00</span>
              <span class="label">Segundos</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GALLERY -->
    <section class="gallery section" aria-labelledby="t-gal">
      <div class="wrap">
        <h2 id="t-gal" class="center" style="letter-spacing:.06em">Recuerdos</h2>
        <p class="gallery-note muted">Tres destellos flotando para recordar momentos especiales, atrapados en el espacio-tiempo, recordando ¿quien soy? </p>
        <div class="carousel-wrap">
          <div class="carousel-stage">
            <div class="carousel" id="memories" aria-label="Carrusel tridimensional de recuerdos">
              <figure class="carousel-item" style="--index:0">
                <img loading="lazy" src="asset/img1.jpg" />
              </figure>
              <figure class="carousel-item" style="--index:1">
                <img loading="lazy" src="asset/img2.jpg" />
              </figure>
              <figure class="carousel-item" style="--index:2">
                <img loading="lazy" src="asset/img4.jpg" />
              </figure>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CLOSING -->
    <section class="closing section" aria-label="Buenos deseos y firma">
      <div class="wrap">
        <h2 class="big" id="final-text">Muchas Felicidades! <div class="sweep" id="sweep" aria-hidden="true"></div></h2>
        <p class="muted">Con cari&ntilde;o, W.A.</p>
        <button id="surprise" class="play" aria-controls="fx" aria-expanded="false">Sorpresa &#10024;</button>
      </div>
      <canvas id="fx" width="600" height="300"></canvas>
      <div class="celebration-overlay" id="celebration" aria-hidden="true">
        <div class="celebration-layer balloon-field" id="balloonField" aria-hidden="true"></div>
        <div class="celebration-layer confetti-field" id="confettiField" aria-hidden="true"></div>
        <div class="cake-stage" id="cakeStage">
          <div class="cake" role="img" aria-label="Pastel de cumplea&ntilde;os con velas encendidas">
            <div class="cake__shadow" aria-hidden="true"></div>
            <div class="cake__stand" aria-hidden="true"></div>
            <div class="cake__tier cake__tier--bottom" aria-hidden="true">
              <span class="cake__band"></span>
              <span class="cake__frosting cake__frosting--bottom"></span>
              <span class="cake__flower cake__flower--1"></span>
              <span class="cake__flower cake__flower--2"></span>
            </div>
            <div class="cake__tier cake__tier--middle" aria-hidden="true">
              <span class="cake__band cake__band--middle"></span>
              <span class="cake__frosting cake__frosting--middle"></span>
              <span class="cake__flower cake__flower--3"></span>
              <span class="cake__flower cake__flower--4"></span>
            </div>
            <div class="cake__tier cake__tier--top" aria-hidden="true">
              <span class="cake__band cake__band--top"></span>
              <span class="cake__frosting cake__frosting--top"></span>
            </div>
            <div class="cake__candles" aria-hidden="true">
              <div class="candle">
                <span class="candle__body"></span>
                <span class="candle__wick"></span>
                <span class="candle__flame"></span>
                <span class="candle__smoke candle__smoke--a"></span>
                <span class="candle__smoke candle__smoke--b"></span>
              </div>
              <div class="candle">
                <span class="candle__body"></span>
                <span class="candle__wick"></span>
                <span class="candle__flame"></span>
                <span class="candle__smoke candle__smoke--a"></span>
                <span class="candle__smoke candle__smoke--b"></span>
              </div>
              <div class="candle">
                <span class="candle__body"></span>
                <span class="candle__wick"></span>
                <span class="candle__flame"></span>
                <span class="candle__smoke candle__smoke--a"></span>
                <span class="candle__smoke candle__smoke--b"></span>
              </div>
              <div class="candle">
                <span class="candle__body"></span>
                <span class="candle__wick"></span>
                <span class="candle__flame"></span>
                <span class="candle__smoke candle__smoke--a"></span>
                <span class="candle__smoke candle__smoke--b"></span>
              </div>
            </div>
          </div>
          <p class="cake-stage__prompt">Apaga las velas</p>
          <button id="blowOut" class="cake-stage__button" type="button" aria-disabled="false">Apagar</button>
        </div>
      </div>
    </section>
  </main>

  <button class="audio-toggle" id="audio-toggle" aria-pressed="true" aria-label="Pausar m&uacute;sica">
    <span class="icon" aria-hidden="true">&#9208;</span>
  </button>
  <button class="to-top" id="toTop" aria-label="Volver arriba">&uarr;</button>
  <footer class="wrap">
    <small>.</small>
  </footer>

  <script>
  (function(){
    const body = document.body;
    // THEME TOGGLE
    const themeBtn = document.getElementById('theme');
    const saved = localStorage.getItem('theme');
    if(saved){ body.setAttribute('data-theme', saved); themeBtn.setAttribute('aria-pressed', String(saved==='dark')); }
    themeBtn.addEventListener('click', ()=>{
      const cur = body.getAttribute('data-theme')==='dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', cur);
      localStorage.setItem('theme', cur);
      themeBtn.setAttribute('aria-pressed', String(cur==='dark'));
    });

    // AUDIO CONTROL
    const bgAudio = document.getElementById('bg-audio');
    const audioToggle = document.getElementById('audio-toggle');
    if(bgAudio){ bgAudio.volume = 0.4; }
    if(bgAudio && audioToggle){
      const iconEl = audioToggle.querySelector('.icon');
      const PLAYING_ICON = String.fromCharCode(0x23F8);
      const PAUSED_ICON = String.fromCharCode(0x25B6);
      const PLAYING_LABEL = 'Pausar m\u00fasica';
      const PAUSED_LABEL = 'Reproducir m\u00fasica';
      const setState = (playing)=>{
        audioToggle.classList.toggle('is-paused', !playing);
        audioToggle.setAttribute('aria-pressed', String(playing));
        audioToggle.setAttribute('aria-label', playing ? PLAYING_LABEL : PAUSED_LABEL);
        if(iconEl){ iconEl.textContent = playing ? PLAYING_ICON : PAUSED_ICON; }
      };
      const attemptPlay = ()=>{
        const res = bgAudio.play();
        if(res && typeof res.then === 'function'){
          res.then(()=> setState(true)).catch(()=> setState(false));
        } else {
          setState(!bgAudio.paused);
        }
      };
      setState(!bgAudio.paused);
      attemptPlay();
      audioToggle.addEventListener('click', ()=>{
        if(bgAudio.paused){
          bgAudio.play().then(()=> setState(true)).catch(()=> setState(false));
        } else {
          bgAudio.pause();
          setState(false);
        }
      });
      const unlock = ()=>{
        if(bgAudio.paused){
          bgAudio.play().then(()=> setState(true)).catch(()=> setState(false));
        }
      };
      document.addEventListener('pointerdown', unlock, {once:true});
      document.addEventListener('keydown', unlock, {once:true});
      bgAudio.addEventListener('play', ()=> setState(true));
      bgAudio.addEventListener('pause', ()=> setState(false));
    }
    // PARALLAX (rAF single loop)
    const parRoot = document.querySelector('.parallax');
    const layers = [...document.querySelectorAll('.layer')].filter(function(el){ return !el.classList.contains('balloons'); });
    let y=0; let ticking=false;
    const onScroll = ()=>{ y = window.scrollY || window.pageYOffset; if(!ticking){ requestAnimationFrame(update); ticking=true; }};
    function update(){
      const d = Math.min(1, (y/600)); // damp
      layers.forEach((el,i)=>{
        const depth = [-60,-30,-10,0][i] || -8; // fallback depth
        el.style.transform = `translateZ(${depth}px) translateY(${d* (i===0? -8: i===1? -14: -10)}px)`;
      });
      ticking=false;
    }
    document.addEventListener('scroll', onScroll, {passive:true}); update();

    // CONFETTI (DOM subtle)
    const conf = document.getElementById('confetti');
    const colors = ['#F59E0B','#E879F9','#38BDF8','#22D3EE','#F97316','#A855F7','#4ADE80','#ffffff'];
    for(let i=0;i<24;i++){
      const p=document.createElement('i'); p.className='piece'; conf.appendChild(p);
      p.style.left = (Math.random()*100)+'%';
      p.style.top = (-Math.random()*80)+'vh';
      p.style.background = colors[i%colors.length];
      p.style.animationDuration = (6 + Math.random()*6)+'s';
      p.style.animationDelay = (-Math.random()*6)+'s';
      p.style.transform = `translateY(${(-20 - Math.random()*60)}vh) rotate(${Math.random()*180}deg)`;
      p.style.opacity = 0.4 + Math.random()*0.5;
      p.style.width = (4+Math.random()*4)+'px';
      p.style.height = (8+Math.random()*8)+'px';
    }

    // BALLOONS (gentle stream)
    const balloonLayer = document.querySelector('.balloons');
    if(balloonLayer){
      const palette = [
        ['#FDE68A','#FBCFE8'],
        ['#BAE6FD','#A5F3FC'],
        ['#E0E7FF','#C7D2FE'],
        ['#FBCFE8','#FCE7F3'],
        ['#F8FAFC','#E2E8F0']
      ];
      const mobileQuery = window.matchMedia('(max-width: 720px)');
      const total = mobileQuery.matches ? 10 : window.matchMedia('(min-width: 1200px)').matches ? 18 : 14;
      let mobileLanes = mobileQuery.matches ? [6, 18, 32, 46, 60, 74, 88] : null;
      let laneIndex = 0;

      const clamp = (value, min, max)=> Math.min(max, Math.max(min, value));

      const getLaneLeft = (el)=>{
        if(mobileLanes){
          if(!el.dataset.lane){
            el.dataset.lane = String(mobileLanes[laneIndex % mobileLanes.length]);
            laneIndex++;
          }
          return parseFloat(el.dataset.lane);
        }
        if(!el.dataset.left){
          el.dataset.left = (6 + Math.random()*88).toFixed(2);
        }
        return parseFloat(el.dataset.left);
      };

      const jitter = (previous, min, max, step)=>{
        if(!Number.isFinite(previous)){
          return clamp(min + Math.random()*(max - min), min, max);
        }
        return clamp(previous + (Math.random()*2 - 1) * step, min, max);
      };

      const applyBalloonStyle = (el, initial=false)=>{
        const shades = palette[Math.floor(Math.random()*palette.length)];
        const baseDuration = mobileQuery.matches ? 24 : 17;
        const duration = jitter(parseFloat(el.dataset.duration), baseDuration - 4, baseDuration + 4, 2.2);
        el.dataset.duration = duration.toFixed(2);

        let leftBase = getLaneLeft(el);
        if(mobileLanes){
          leftBase = clamp(leftBase + (Math.random()*2.4 - 1.2), 4, 96);
        }else{
          leftBase = clamp(jitter(leftBase, 8, 92, 5.5), 2, 98);
          el.dataset.left = leftBase.toFixed(2);
        }

        const depth = jitter(parseFloat(el.dataset.depth), -30, -8, 4.5);
        el.dataset.depth = depth.toFixed(1);

        const baseScale = mobileQuery.matches ? 0.84 : 0.94;
        const scale = jitter(parseFloat(el.dataset.scale), baseScale - 0.08, baseScale + 0.12, 0.05);
        el.dataset.scale = scale.toFixed(2);

        const driftBand = mobileQuery.matches ? 20 : 28;
        const drift = jitter(parseFloat(el.dataset.drift), -driftBand/2, driftBand/2, driftBand*0.25);
        el.dataset.drift = drift.toFixed(1);
        const driftEnd = jitter(parseFloat(el.dataset.driftEnd), -driftBand/2, driftBand/2, driftBand*0.25);
        el.dataset.driftEnd = driftEnd.toFixed(1);

        el.style.setProperty('--tone-a', shades[0]);
        el.style.setProperty('--tone-b', shades[1]);
        el.style.setProperty('--duration', duration.toFixed(2) + 's');
        el.style.setProperty('--delay', (initial ? -Math.random()*duration : 0).toFixed(2) + 's');
        el.style.setProperty('--left', leftBase.toFixed(2) + '%');
        el.style.setProperty('--depth', depth.toFixed(1) + 'px');
        el.style.setProperty('--scale', scale.toFixed(2));
        el.style.setProperty('--scale-hi', (scale + 0.08).toFixed(2));
        el.style.setProperty('--drift', drift.toFixed(1) + 'px');
        el.style.setProperty('--drift-end', driftEnd.toFixed(1) + 'px');
        if(!initial){
          el.style.animationDuration = duration.toFixed(2) + 's';
        }
      };

      const refreshLanes = ()=>{
        mobileLanes = mobileQuery.matches ? [6, 18, 32, 46, 60, 74, 88] : null;
        laneIndex = 0;
        balloonLayer.querySelectorAll('.balloon').forEach((el)=>{
          delete el.dataset.lane;
          if(mobileLanes){
            delete el.dataset.left;
          }else{
            el.dataset.left = (6 + Math.random()*88).toFixed(2);
          }
          applyBalloonStyle(el, true);
        });
      };

      if(mobileQuery.addEventListener){
        mobileQuery.addEventListener('change', refreshLanes);
      }else if(mobileQuery.addListener){
        mobileQuery.addListener(refreshLanes);
      }

      for(let i=0;i<total;i++){
        const balloon = document.createElement('span');
        balloon.className = 'balloon';
        applyBalloonStyle(balloon, true);
        balloon.addEventListener('animationiteration', ()=> requestAnimationFrame(()=> applyBalloonStyle(balloon)) );
        balloonLayer.appendChild(balloon);
      }
    }

    // STORY FLOWERS (canvas waves)
    const storySection = document.querySelector('.story');
    const flowerCanvas = document.getElementById('story-flowers');
    if(storySection && flowerCanvas){
      const fCtx = flowerCanvas.getContext('2d');
      const flowerPalette = [
        {outer:'rgba(232,121,249,0.55)', tip:'rgba(255,255,255,0.85)', center:'rgba(245,158,11,0.6)'},
        {outer:'rgba(148,163,209,0.5)', tip:'rgba(224,231,255,0.82)', center:'rgba(56,189,248,0.55)'},
        {outer:'rgba(56,189,248,0.55)', tip:'rgba(190,242,255,0.82)', center:'rgba(248,172,120,0.58)'}
      ];
      let flowers = [];
      let rafId = null;
      let playing = false;

      const setupFlowers = ()=>{
        const ratio = window.devicePixelRatio || 1;
        const width = storySection.clientWidth || 1;
        const height = storySection.clientHeight || 1;
        flowerCanvas.width = Math.max(1, Math.floor(width * ratio));
        flowerCanvas.height = Math.max(1, Math.floor(height * ratio));
        flowerCanvas.style.width = width + 'px';
        flowerCanvas.style.height = height + 'px';
        const count = Math.max(10, Math.round(width / 90));
        flowers = Array.from({length: count}, ()=>{
          const paletteEntry = flowerPalette[Math.floor(Math.random()*flowerPalette.length)];
          const baseX = width * (0.12 + Math.random()*0.76);
          const baseY = height * (0.2 + Math.random()*0.65);
          return {
            x: baseX,
            y: baseY,
            size: 24 + Math.random()*28,
            petals: 5 + Math.floor(Math.random()*2),
            rotation: Math.random()*Math.PI*2,
            sway: 8 + Math.random()*14,
            wave: 0.4 + Math.random()*0.35,
            drift: 0.25 + Math.random()*0.3,
            offset: Math.random()*Math.PI*2,
            colors: paletteEntry
          };
        });
      };

      const drawFlower = (flower, t)=>{
        const ratio = window.devicePixelRatio || 1;
        const swingX = Math.sin(t * flower.wave + flower.offset) * flower.sway;
        const swingY = Math.cos(t * (flower.wave * 0.8) + flower.offset) * flower.sway * 0.35;
        const px = (flower.x + swingX) * ratio;
        const py = (flower.y + swingY) * ratio;
        const size = flower.size * ratio;
        const petals = flower.petals;

        fCtx.save();
        fCtx.translate(px, py);
        fCtx.rotate(flower.rotation + Math.sin(t * flower.drift + flower.offset) * 0.35);
        fCtx.shadowColor = flower.colors.tip;
        fCtx.shadowBlur = size * 0.18;

        for(let i=0;i<petals;i++){
          fCtx.save();
          fCtx.rotate((Math.PI * 2 / petals) * i);
          const grad = fCtx.createLinearGradient(0,0,0,-size);
          grad.addColorStop(0, 'rgba(255,255,255,0)');
          grad.addColorStop(0.55, flower.colors.outer);
          grad.addColorStop(1, flower.colors.tip);
          fCtx.fillStyle = grad;
          fCtx.beginPath();
          fCtx.moveTo(0,0);
          fCtx.quadraticCurveTo(size * 0.45, -size * 0.55, 0, -size);
          fCtx.quadraticCurveTo(-size * 0.45, -size * 0.55, 0,0);
          fCtx.closePath();
          fCtx.fill();
          fCtx.restore();
        }

        fCtx.shadowBlur = 0;
        fCtx.fillStyle = flower.colors.center;
        fCtx.beginPath();
        fCtx.arc(0,0,size * 0.22, 0, Math.PI * 2);
        fCtx.fill();
        fCtx.restore();
      };

      const renderFlowers = (time)=>{
        if(!playing){ return; }
        fCtx.clearRect(0,0,flowerCanvas.width, flowerCanvas.height);
        fCtx.globalCompositeOperation = 'lighter';
        const t = time * 0.001;
        flowers.forEach((flower)=> drawFlower(flower, t));
        fCtx.globalCompositeOperation = 'source-over';
        rafId = requestAnimationFrame(renderFlowers);
      };

      const startFlowers = ()=>{
        if(rafId){ cancelAnimationFrame(rafId); }
        playing = true;
        rafId = requestAnimationFrame(renderFlowers);
      };

      const stopFlowers = ()=>{
        playing = false;
        if(rafId){ cancelAnimationFrame(rafId); rafId = null; }
      };

      const storyObserver = new IntersectionObserver((entries)=>{
        entries.forEach((entry)=>{
          if(entry.isIntersecting){
            setupFlowers();
            startFlowers();
          }else{
            stopFlowers();
          }
        });
      }, {threshold:0.25});

      storyObserver.observe(storySection);

      const resizeObserver = new ResizeObserver(()=>{
        setupFlowers();
        if(playing){
          if(rafId){ cancelAnimationFrame(rafId); }
          rafId = requestAnimationFrame(renderFlowers);
        }
      });
      resizeObserver.observe(storySection);
      setupFlowers();
    }


    // INTERSECTION OBSERVER (stagger reveal)
    const io = new IntersectionObserver((entries)=>{
      entries.forEach((e)=>{
        if(e.isIntersecting){
          const items = e.target.querySelectorAll('.reveal');
          if(items.length){ items.forEach((el,idx)=> setTimeout(()=>el.classList.add('is-visible'), 120*idx)); }
          else{ e.target.classList.add('is-visible'); }
          io.unobserve(e.target);
        }
      })
    }, {threshold:.2});


    const memoriesCarousel = document.getElementById('memories');
    if(memoriesCarousel){
      let resumeTimer;
      const pause = ()=> memoriesCarousel.classList.add('is-paused');
      const play = ()=> memoriesCarousel.classList.remove('is-paused');
      requestAnimationFrame(()=> memoriesCarousel.classList.add('is-ready'));
      memoriesCarousel.addEventListener('pointerenter', pause);
      memoriesCarousel.addEventListener('pointerleave', play);
      memoriesCarousel.addEventListener('touchstart', ()=>{
        pause();
        if(resumeTimer){ clearTimeout(resumeTimer); }
        resumeTimer = setTimeout(play, 2800);
      }, {passive:true});
    }

    const highlightsGrid = document.querySelector('.highlights .grid');
    if(highlightsGrid){
      const highlightCards = [...highlightsGrid.querySelectorAll('.card')];
      highlightCards.forEach((card, idx)=>{
        card.style.transitionDelay = `${idx * 120}ms`; 
      });
      const highlightObserver = new IntersectionObserver((entries)=>{
        entries.forEach((entry)=>{
          if(entry.isIntersecting){
            highlightCards.forEach((card, idx)=>{
              setTimeout(()=> card.classList.add('is-visible'), idx * 140);
            });
            highlightObserver.unobserve(entry.target);
          }
        });
      }, {threshold:0.25});
      highlightObserver.observe(highlightsGrid);
    }

    document.querySelectorAll('.story .wrap, .carousel-item').forEach(el=> io.observe(el.closest('.story .wrap') || el));

    // CARD INTERACTION (press glow)
    document.querySelectorAll('.card').forEach((card)=>{
      let pressTimer;
      const release = ()=>{
        if(pressTimer){ clearTimeout(pressTimer); }
        pressTimer = setTimeout(()=> card.classList.remove('is-pressed'), 380);
      };
      card.addEventListener('pointerdown', ()=>{
        card.classList.add('is-pressed');
        if(pressTimer){ clearTimeout(pressTimer); }
      });
      card.addEventListener('pointerup', release);
      card.addEventListener('pointercancel', release);
      card.addEventListener('mouseleave', ()=> card.classList.remove('is-pressed'));
      card.addEventListener('click', ()=>{
        if(pressTimer){ clearTimeout(pressTimer); }
        pressTimer = setTimeout(()=> card.classList.remove('is-pressed'), 480);
      });
    });

    // ToTop button
    const toTop = document.getElementById('toTop');
    const onToTop = ()=>{ if(window.scrollY>300){toTop.classList.add('show')} else {toTop.classList.remove('show')} };
    document.addEventListener('scroll', onToTop, {passive:true}); onToTop();
    toTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    // COUNTDOWN (next birthday)
    const dd = document.getElementById('d-day');
    const dh = document.getElementById('d-h');
    const dm = document.getElementById('d-m');
    const ds = document.getElementById('d-s');
    const note = document.getElementById('today-note');
    const today = new Date();
    note.textContent = `Hoy es ${today.toLocaleDateString(undefined,{weekday:'long', year:'numeric', month:'long', day:'numeric'})}`;

    const BIRTHDAY_MONTH = 8; // September (0-index)
    const BIRTHDAY_DAY = 25;

    const getNextBirthday = (reference)=>{
      const target = new Date(reference.getFullYear(), BIRTHDAY_MONTH, BIRTHDAY_DAY, 0, 0, 0, 0);
      if(target <= reference){
        target.setFullYear(target.getFullYear() + 1);
      }

      return target;
    };

    let birthdayTarget = getNextBirthday(today);

    function tick(){
      const current = new Date();
      if(current > birthdayTarget){
        birthdayTarget = getNextBirthday(current);
      }
      const totalSeconds = Math.max(0, Math.floor((birthdayTarget - current) / 1000));
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      dd.textContent = String(days).padStart(3,'0');
      dh.textContent = String(hours).padStart(2,'0');
      dm.textContent = String(minutes).padStart(2,'0');
      ds.textContent = String(seconds).padStart(2,'0');
      requestAnimationFrame(tick);
    }
    tick();

    // SURPRISE (celebration overlay)
    const btn = document.getElementById('surprise');
    const canvas = document.getElementById('fx');
    const celebration = document.getElementById('celebration');
    const balloonField = document.getElementById('balloonField');
    const confettiField = document.getElementById('confettiField');
    const cakeStage = document.getElementById('cakeStage');
    const blowBtn = document.getElementById('blowOut');

    if(btn && canvas && celebration && balloonField && confettiField && cakeStage){
      const ctx = canvas.getContext('2d');
      let w = 0;
      let h = 0;
      let particles = [];
      let sparklesActive = false;
      let sparkleFrame = 0;
      let celebrationLock = false;
      const timerHandles = new Set();
      const sparklePalette = ['rgba(232,121,249,0.82)','rgba(56,189,248,0.88)','rgba(251,191,36,0.85)','rgba(148,163,209,0.78)','rgba(244,114,182,0.82)','rgba(165,243,252,0.84)'];
      const confettiPalette = ['#F59E0B','#F97316','#FDBA74','#E879F9','#C084FC','#38BDF8','#22D3EE','#F8FAFC','#4ADE80'];
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');

      function schedule(fn, delay){
        const handle = setTimeout(()=>{ timerHandles.delete(handle); fn(); }, delay);
        timerHandles.add(handle);
      }

      function clearScheduled(){
        timerHandles.forEach(clearTimeout);
        timerHandles.clear();
      }

      function resizeCanvas(){
        const ratio = window.devicePixelRatio || 1;
        const width = canvas.clientWidth || window.innerWidth;
        const height = canvas.clientHeight || window.innerHeight;
        canvas.width = Math.floor(width * ratio);
        canvas.height = Math.floor(height * ratio);
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(ratio, ratio);
        w = width;
        h = height;
      }

      if('ResizeObserver' in window){
        new ResizeObserver(resizeCanvas).observe(canvas);
      }else{
        window.addEventListener('resize', resizeCanvas);
      }
      resizeCanvas();

      function spawnSparkle(){
        const angle = Math.random() * Math.PI * 2;
        const radius = 40 + Math.random() * 160;
        particles.push({
          x: w / 2 + Math.cos(angle) * radius,
          y: h * 0.82 + Math.sin(angle) * 12 + Math.random() * 40,
          vx: (Math.random() - 0.5) * 0.9,
          vy: -(0.9 + Math.random() * 1.6),
          drag: 0.985 + Math.random() * 0.01,
          life: 130 + Math.random() * 80,
          size: 2.4 + Math.random() * 3.6,
          color: sparklePalette[Math.floor(Math.random() * sparklePalette.length)],
          alpha: 0.85 + Math.random() * 0.12
        });
      }

      function renderSparkles(){
        if(!sparklesActive){
          ctx.clearRect(0,0,w,h);
          return;
        }
        ctx.clearRect(0,0,w,h);
        const maxParticles = reduceMotion && reduceMotion.matches ? 70 : 140;
        if(particles.length < maxParticles){
          spawnSparkle();
          if(particles.length < maxParticles - 10 && !(reduceMotion && reduceMotion.matches)){
            spawnSparkle();
          }
        }
        ctx.globalCompositeOperation = 'lighter';
        particles.forEach((p)=>{
          p.x += p.vx;
          p.y += p.vy;
          p.vx *= p.drag;
          p.vy = p.vy * p.drag - 0.012;
          p.life -= 1;
          const fade = Math.max(0, p.life / 180);
          ctx.globalAlpha = fade * p.alpha;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();
        });
        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = 'source-over';
        particles = particles.filter((p)=> p.life > 0 && p.y > -60);
        sparkleFrame = requestAnimationFrame(renderSparkles);
      }

      function startSparkles(){
        if(sparklesActive){
          return;
        }
        sparklesActive = true;
        canvas.classList.add('is-active');
        particles = [];
        renderSparkles();
      }

      function stopSparkles(){
        sparklesActive = false;
        cancelAnimationFrame(sparkleFrame);
        canvas.classList.remove('is-active');
        ctx.clearRect(0,0,w,h);
      }

      function makeBalloon(){
        const balloon = document.createElement('span');
        balloon.className = 'celebration-balloon';
        const hue = Math.floor(Math.random() * 360);
        const size = 74 + Math.random() * 96;
        const duration = 10 + Math.random() * 7;
        const scale = 0.82 + Math.random() * 0.35;
        balloon.style.left = (6 + Math.random() * 88).toFixed(2) + '%';
        balloon.style.setProperty('--hue', String(hue));
        balloon.style.setProperty('--size', size.toFixed(2) + 'px');
        balloon.style.setProperty('--duration', duration.toFixed(2) + 's');
        balloon.style.setProperty('--delay', (-Math.random() * 2).toFixed(2) + 's');
        balloon.style.setProperty('--scale', scale.toFixed(2));
        balloon.style.setProperty('--scale-hi', (scale + 0.12).toFixed(2));
        balloon.style.setProperty('--drift-start', (Math.random() * 40 - 20).toFixed(2) + 'px');
        balloon.style.setProperty('--drift-mid', (Math.random() * 120 - 60).toFixed(2) + 'px');
        balloon.style.setProperty('--drift-end', (Math.random() * 160 - 80).toFixed(2) + 'px');
        balloon.addEventListener('animationend', ()=> balloon.remove());
        return balloon;
      }

      function launchBalloons(){
        const lowMotion = reduceMotion && reduceMotion.matches;
        const total = lowMotion ? 12 : (window.innerWidth < 680 ? 20 : 30);
        for(let i=0;i<total;i++){
          const delay = (lowMotion ? 180 : 140) * i + Math.random() * 220;
          schedule(()=>{
            if(!celebration.classList.contains('is-visible')){ return; }
            balloonField.appendChild(makeBalloon());
          }, delay);
        }
      }

      function makeConfetti(){
        const piece = document.createElement('span');
        piece.className = 'celebration-confetti';
        const width = 6 + Math.random() * 5;
        const height = 14 + Math.random() * 12;
        const duration = 5.6 + Math.random() * 3.2;
        const delay = Math.random() * 1.6;
        const colors = confettiPalette.slice().sort(()=> 0.5 - Math.random());
        piece.style.setProperty('--left', (6 + Math.random() * 88).toFixed(2) + '%');
        piece.style.setProperty('--width', width.toFixed(2) + 'px');
        piece.style.setProperty('--height', height.toFixed(2) + 'px');
        piece.style.setProperty('--duration', duration.toFixed(2) + 's');
        piece.style.setProperty('--delay', delay.toFixed(2) + 's');
        piece.style.setProperty('--sway-start', (Math.random() * 40 - 20).toFixed(2) + 'px');
        piece.style.setProperty('--sway-mid', (Math.random() * 240 - 120).toFixed(2) + 'px');
        piece.style.setProperty('--sway-end', (Math.random() * 280 - 140).toFixed(2) + 'px');
        piece.style.setProperty('--spin-mid', (140 + Math.random() * 140).toFixed(2) + 'deg');
        piece.style.setProperty('--spin-end', (300 + Math.random() * 200).toFixed(2) + 'deg');
        piece.style.setProperty('--tilt-mid', (26 + Math.random() * 32).toFixed(2) + 'deg');
        piece.style.setProperty('--tilt-end', (-12 - Math.random() * 28).toFixed(2) + 'deg');
        piece.style.setProperty('--color-a', colors[0]);
        piece.style.setProperty('--color-b', colors[1] || colors[0]);
        piece.addEventListener('animationend', ()=> piece.remove());
        return piece;
      }

      function launchConfetti(){
        const lowMotion = reduceMotion && reduceMotion.matches;
        const total = lowMotion ? 80 : (window.innerWidth < 680 ? 120 : 180);
        for(let i=0;i<total;i++){
          const delay = (lowMotion ? 80 : 60) * i + Math.random() * 320;
          schedule(()=>{
            if(!celebration.classList.contains('is-visible')){ return; }
            confettiField.appendChild(makeConfetti());
          }, delay);
        }
      }

      function prepareCelebration(){
        clearScheduled();
        balloonField.textContent = '';
        confettiField.textContent = '';
        celebration.classList.remove('show-cake');
        celebration.classList.remove('is-dismissing');
        cakeStage.classList.remove('candles-out');
        cakeStage.classList.remove('is-hiding');
        celebration.setAttribute('aria-hidden', 'false');
        if(blowBtn){
          blowBtn.disabled = false;
          blowBtn.setAttribute('aria-disabled', 'false');
          blowBtn.textContent = 'Apagar';
          blowBtn.classList.remove('is-complete');
        }
      }

      btn.addEventListener('click', ()=>{
        if(celebrationLock){
          return;
        }
        celebrationLock = true;
        btn.setAttribute('aria-expanded', 'true');
        celebration.classList.add('is-visible');
        prepareCelebration();
        startSparkles();
        launchBalloons();
        launchConfetti();
        const lowMotion = reduceMotion && reduceMotion.matches;
        const revealDelay = lowMotion ? 1400 : 2600;
        schedule(()=> celebration.classList.add('show-cake'), revealDelay);
        schedule(()=>{ celebrationLock = false; }, revealDelay + (lowMotion ? 1800 : 3600));
      });

      if(blowBtn){
        blowBtn.addEventListener('click', ()=>{
          if(blowBtn.disabled){
            return;
          }
          clearScheduled();
          cakeStage.classList.add('candles-out');
          cakeStage.classList.add('is-hiding');
          blowBtn.disabled = true;
          blowBtn.setAttribute('aria-disabled', 'true');
          blowBtn.classList.add('is-complete');
          blowBtn.textContent = 'Listo ✨';
          setTimeout(()=> blowBtn.blur(), 20);
          stopSparkles();
          celebration.classList.add('is-dismissing');
          schedule(()=>{
            balloonField.textContent = '';
            confettiField.textContent = '';
          }, 140);
          schedule(()=>{
            celebration.classList.remove('show-cake');
            celebration.classList.remove('is-visible');
            celebration.classList.remove('is-dismissing');
            celebration.setAttribute('aria-hidden', 'true');
            btn.setAttribute('aria-expanded', 'false');
            cakeStage.classList.remove('candles-out');
            cakeStage.classList.remove('is-hiding');
            blowBtn.disabled = false;
            blowBtn.setAttribute('aria-disabled', 'false');
            blowBtn.classList.remove('is-complete');
            blowBtn.textContent = 'Apagar';
            celebrationLock = false;
          }, 1500);
        });
      }

      document.addEventListener('visibilitychange', ()=>{
        if(document.hidden){
          stopSparkles();
        }else if(celebration.classList.contains('is-visible')){
          startSparkles();
        }
      });
    }


  })();
  </script>
</body>
</html> 
